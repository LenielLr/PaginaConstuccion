<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ proyecto.nombre }} - Constructora Premium</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèóÔ∏è</text></svg>">
</head>
<body>
    <header>
        <h1>üèóÔ∏è {{ proyecto.nombre }}</h1>
        <nav>
            <a href="{{ url_for('home') }}">üè† Volver a la Galer√≠a</a>
            <a href="{{ url_for('editar', id=proyecto.id) }}" class="btn-header">‚úèÔ∏è Editar Proyecto</a>
        </nav>
    </header>

    <main class="detalle">
        <!-- Header del proyecto -->
        <div class="detalle-header">
            <h1>{{ proyecto.nombre }}</h1>
            <div class="detalle-stats">
                {% if proyecto.get('fecha_agregado') %}
                    <div class="stat-item">
                        <span>üìÖ</span>
                        <strong>Fecha:</strong> {{ proyecto.fecha_agregado }}
                    </div>
                {% endif %}
                <div class="stat-item">
                    <span>üëÅÔ∏è</span>
                    <strong>Vistas:</strong> {{ proyecto.vistas }}
                </div>
                <div class="stat-item">
                    <span>
                        {% if proyecto.imagen.endswith('.mp4') or proyecto.imagen.endswith('.mov') or proyecto.imagen.endswith('.webm') %}
                            üé•
                        {% else %}
                            üì∏
                        {% endif %}
                    </span>
                    <strong>Tipo:</strong> 
                    {% if proyecto.imagen.endswith('.mp4') or proyecto.imagen.endswith('.mov') or proyecto.imagen.endswith('.webm') %}
                        Video
                    {% else %}
                        Imagen
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Media (imagen o video) -->
        <div class="detalle-media">
            {% if proyecto.imagen.endswith('.mp4') or proyecto.imagen.endswith('.mov') or proyecto.imagen.endswith('.webm') %}
                <video id="preview" controls>
                    <source src="{{ proyecto.imagen }}" type="video/mp4">
                    Tu navegador no soporta video HTML5.
                </video>
            {% else %}
                <img id="preview" src="{{ proyecto.imagen }}" alt="{{ proyecto.nombre }}">
            {% endif %}
        </div>

        <!-- Contenido -->
        <div class="detalle-content">
            <h2>üìã Descripci√≥n del Proyecto</h2>
            <p>{{ proyecto.descripcion }}</p>
            
            {% if proyecto.get('media') and proyecto.media|length > 0 %}
                <h2 style="margin-top: 2rem;">üñºÔ∏è Galer√≠a Adicional</h2>
                <div class="galeria-mini">
                    {% for item in proyecto.media %}
                        <img src="{{ item }}" alt="Imagen adicional" style="max-width: 200px; margin: 0.5rem; border-radius: 8px;">
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Acciones r√°pidas -->
        <div class="detalle-actions">
            <a href="{{ url_for('editar', id=proyecto.id) }}" class="btn btn-editar">
                <span>‚úèÔ∏è Editar Proyecto</span>
            </a>
            <form action="{{ url_for('eliminar', id=proyecto.id) }}" method="post" style="display: inline;" onsubmit="return confirm('¬øEst√°s seguro de eliminar este proyecto? Esta acci√≥n no se puede deshacer.');">
                <button type="submit" class="btn btn-eliminar">
                    <span>üóëÔ∏è Eliminar Proyecto</span>
                </button>
            </form>
            <a href="{{ url_for('home') }}" class="btn btn-ver">
                <span>üè† Volver a la Galer√≠a</span>
            </a>
        </div>
    </main>

    <!-- Modal para ampliar -->
    <div id="modal" class="modal">
        <span class="close">&times;</span>
        <div id="modal-content" class="modal-content"></div>
    </div>

    <script>
        const preview = document.getElementById("preview");
        const modal = document.getElementById("modal");
        const modalContent = document.getElementById("modal-content");
        const closeBtn = document.querySelector(".close");

        // Abrir modal al hacer click
        preview.addEventListener("click", () => {
            modal.style.display = "flex";
            if (preview.tagName === "VIDEO") {
                const videoSrc = preview.querySelector('source').src;
                modalContent.innerHTML = `<video controls autoplay src="${videoSrc}"></video>`;
            } else {
                modalContent.innerHTML = `<img src="${preview.src}" alt="Vista ampliada">`;
            }
        });

        // Cerrar modal
        closeBtn.addEventListener("click", () => {
            modal.style.display = "none";
            modalContent.innerHTML = "";
        });

        // Cerrar al hacer click fuera
        window.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.style.display = "none";
                modalContent.innerHTML = "";
            }
        });

        // Cerrar con tecla ESC
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modal.style.display === "flex") {
                modal.style.display = "none";
                modalContent.innerHTML = "";
            }
        });
    </script>
</body>
</html>